# ビジネス要件定義書

## 1. プロジェクト概要

### 1.1 プロジェクト名
ハックストーリー（HackStory）

### 1.2 プロジェクトの目的
物語を進めながら、実践的なハッキング技術とセキュリティ知識を学習できるインタラクティブなWebアプリケーションを開発する。ゲーミフィケーションの要素を取り入れ、楽しみながらセキュリティスキルを身につけられる学習プラットフォームを提供する。

### 1.3 背景
- サイバーセキュリティの重要性が高まっている一方で、実践的な学習機会が限られている
- 従来の学習方法は理論中心で、実際のハッキング体験が不足している
- エンターテインメント性と教育性を両立した学習ツールの需要がある

## 2. ターゲットユーザー

### 2.1 主要ターゲット
- **セキュリティ初心者**: ハッキングやセキュリティに興味があるが、どこから始めればよいかわからない人
- **IT学習者**: プログラミングやIT技術を学んでいる学生・社会人
- **セキュリティ専門家志望者**: セキュリティエンジニアやペネトレーションテスターを目指す人

### 2.2 ユーザー特性
- ゲームや物語形式の学習を好む
- 実践的なスキル習得を重視
- 段階的な学習を希望

## 3. 機能要件

### 3.1 コア機能

#### 3.1.1 ストーリーモード
- **機能概要**: 物語形式でハッキングシナリオを体験
- **詳細要件**:
  - 複数のチャプターで構成されたストーリーライン
  - 各チャプターで特定のハッキング技術を学習
  - 選択肢による分岐ストーリー
  - ストーリー進行状況の保存・再開機能

#### 3.1.1.1 ストーリー設計要件（面白さ・魅力の向上）

##### ストーリー構造
- **プロット設計**:
  - 三幕構造（導入・展開・クライマックス）を基本とする
  - 各チャプターに明確な目標と緊張感のある展開
  - 予想外の展開や逆転劇を取り入れる
  - 段階的な難易度上昇（初心者から上級者へ）

- **キャラクター設定**:
  - 魅力的な主人公（ユーザーが感情移入できる）
  - 個性的なサポートキャラクター
  - 印象的な敵役・ハッカー
  - キャラクターの成長と変化を描く

- **世界観・設定**:
  - 近未来的でリアリティのある設定
  - 実際のセキュリティ脅威を反映したシナリオ
  - 多様な環境（企業ネットワーク、IoT、クラウドなど）
  - 社会的なテーマ（プライバシー、情報セキュリティの重要性など）

##### 没入感を高める要素
- **ナラティブデザイン**:
  - 臨場感のある描写と会話
  - ユーザーの選択がストーリーに影響を与える
  - 複数のエンディング（良い/悪い/ニュートラル）
  - 隠し要素やイースターエッグ

- **ビジュアル表現**:
  - キャラクターイラスト・アバター
  - シーンに応じた背景・環境表現
  - アニメーション効果（タイピング、コマンド実行など）
  - ムービー風の演出（カットシーン）

- **サウンド・音楽**:
  - シーンに応じたBGM
  - 効果音（キーボード入力、アラート音など）
  - ボイスオーバー（オプション）

##### ゲーミフィケーションとの統合
- **ストーリー進行の報酬**:
  - チャプタークリア時の特別な報酬
  - 選択肢による分岐で異なる報酬
  - ストーリー専用のバッジ・アチーブメント
  - キャラクターとの関係性に応じた報酬

- **リプレイ価値**:
  - 異なる選択肢で別の展開を体験できる
  - 隠しチャプターやシークレットエンディング
  - コレクション要素（発見したアイテム、会話ログなど）

##### 学習とのバランス
- **教育性とエンターテインメント性の両立**:
  - ストーリーが自然に学習内容に導く
  - 技術的な説明をストーリーに組み込む
  - 実践的なハッキング技術を物語の中で体験
  - 学習の達成感とストーリーの感動を両立

- **段階的な学習**:
  - 初心者でも楽しめる導入部分
  - 徐々に高度な技術を学べる構成
  - 復習や補足説明の機会を提供
  - 実世界での応用方法を提示

##### ストーリーテーマ例
- **企業セキュリティ**: ペネトレーションテストのシナリオ
- **個人情報保護**: データ漏洩事件の調査
- **IoTセキュリティ**: スマートホームの脆弱性発見
- **クラウドセキュリティ**: AWS/Azureの設定ミス発見
- **ソーシャルエンジニアリング**: フィッシング攻撃の防御
- **暗号化**: 暗号化されたメッセージの解読
- **ネットワークセキュリティ**: 侵入検知システムの回避と対策

##### ストーリーコンテンツの品質要件
- **コンテンツ制作**:
  - プロのライターまたはストーリーデザイナーによる制作
  - 技術的な正確性の検証（セキュリティ専門家によるレビュー）
  - ユーザーテストによるフィードバック収集
  - 継続的な改善とアップデート

- **コンテンツ管理**:
  - ストーリーコンテンツのバージョン管理
  - A/Bテストによる最適化
  - ユーザーフィードバックの収集と反映
  - 定期的なコンテンツ追加（新チャプター、新ストーリー）

#### 3.1.2 ハッキングチャレンジ
- **機能概要**: 実際のハッキング技術を実践できるインタラクティブなチャレンジ
- **詳細要件**:
  - コマンドライン操作のシミュレーション
  - ネットワークスキャン、脆弱性診断、パスワードクラッキングなどの実践演習
  - ヒントシステム（段階的なヒント提供）
  - 解答チェック機能とフィードバック

#### 3.1.3 学習コンテンツ
- **機能概要**: ハッキング技術に関する解説とリファレンス
- **詳細要件**:
  - 各チャレンジに関連する技術解説
  - 用語集・リファレンス機能
  - ベストプラクティスとセキュリティ対策の説明

#### 3.1.4 進捗管理
- **機能概要**: ユーザーの学習進捗を追跡・表示
- **詳細要件**:
  - 完了したチャプター・チャレンジの記録
  - 獲得したバッジ・アチーブメント
  - 学習統計（学習時間、完了率など）
  - レベル・経験値システム

### 3.2 補助機能

#### 3.2.1 ユーザーアカウント管理
- ユーザー登録・ログイン機能
- プロフィール管理
- 進捗データの保存

#### 3.2.2 コミュニティ機能（将来拡張）
- チャレンジの共有
- ランキング・リーダーボード
- ディスカッション機能

## 4. 非機能要件

### 4.1 パフォーマンス
- ページ読み込み時間: 3秒以内
- API応答時間: 1秒以内
- 同時接続ユーザー数: 1000人以上に対応

### 4.2 セキュリティ
- ユーザー認証の適切な実装（ASP.NET Core Identity、パスワードハッシュ化、JWT認証）
- XSS、SQLインジェクション等の脆弱性対策（.NETの標準セキュリティ機能を活用）
- HTTPS通信の強制（Cloud Runで自動提供）
- 入力値の検証・サニタイゼーション（Data Annotations、FluentValidation）
- CockroachDBの接続暗号化（TLS/SSL）
- 機密情報の管理（Google Secret Manager）

### 4.3 可用性
- システム稼働率: 99.9%以上（CockroachDBのマルチリージョン構成により実現）
- Cloud Runの自動スケーリングによる高可用性
- CockroachDBの自動フェイルオーバー機能
- エラーハンドリングの適切な実装（.NETの例外処理、グローバルエラーハンドラー）
- ユーザーフレンドリーなエラーメッセージ
- ログ管理（Cloud Loggingによる一元管理）

### 4.4 ユーザビリティ
- 直感的なUI/UX設計
- レスポンシブデザイン（モバイル・タブレット・PC対応）
- アクセシビリティ対応（WCAG 2.1 AA準拠）

### 4.5 保守性
- コードの可読性とドキュメント化
- モジュール化された設計
- テストカバレッジ: 80%以上

## 5. 技術要件

### 5.1 フロントエンド
- **採用技術スタック**:
  - **Next.js**（Reactフレームワーク）
    - SSR（Server-Side Rendering）とSSG（Static Site Generation）の両対応
    - API Routesによるフロントエンドとバックエンドの統合
    - 画像最適化、コード分割などのパフォーマンス最適化機能
  - **TypeScript**（型安全性）
  - **Tailwind CSS**（ユーティリティファーストのCSSフレームワーク）
  - **状態管理ライブラリ**（Zustand / Redux Toolkit）
- **デプロイ**: Google Cloud Run（コンテナ化してデプロイ）
  - Next.jsをスタンドアロンモードでビルドし、Node.jsサーバーとして実行
  - SSR（Server-Side Rendering）機能を活用可能
  - 静的アセットはNext.jsの最適化機能を利用

### 5.2 バックエンド
- **採用技術スタック**:
  - **.NET**（ASP.NET Core）
    - エンタープライズグレードのパフォーマンスとセキュリティ
    - 強力な型安全性と豊富な標準ライブラリ
    - クロスプラットフォーム対応（Windows、Linux、macOS）
    - 優れた非同期処理能力
  - **API設計**: RESTful API（将来的にGraphQLの検討も可能）
  - **ORM**: Entity Framework Core（CockroachDBとの統合）

### 5.3 データベース
- **採用データベース**:
  - **CockroachDB**
    - PostgreSQL互換の分散SQLデータベース
    - 自動スケーリングと高可用性
    - マルチリージョン対応による低レイテンシ
    - ACIDトランザクション保証
    - クラウドネイティブな設計

### 5.4 インフラストラクチャ
- **採用構成**:
  - **デプロイ先**: Google Cloud Run
    - **フロントエンド**: Next.jsアプリケーションをコンテナ化してCloud Runにデプロイ
    - **バックエンド**: .NET APIをコンテナ化してCloud Runにデプロイ
    - サーバーレスコンテナ実行環境
    - 自動スケーリング（0からNへのスケール）
    - 従量課金モデルによるコスト効率
    - HTTPSエンドポイントの自動提供
    - リージョン間での負荷分散対応
    - フロントエンドとバックエンドを別々のサービスとして独立してスケール可能
  - **CI/CD**: Cloud Build / GitHub Actions
  - **コンテナ化**: Docker（フロントエンド・バックエンドそれぞれ）
  - **その他**:
    - Cloud Storage（静的アセット、ログ保存）
    - Cloud Logging / Cloud Monitoring（監視・ログ管理）
    - Secret Manager（機密情報管理）
    - Cloud Load Balancing（フロントエンドとバックエンドのルーティング）

### 5.5 開発ツール
- **バージョン管理**: Git
- **コード品質**:
  - フロントエンド: ESLint、Prettier
  - バックエンド: .NET Analyzers、StyleCop、SonarAnalyzer
- **テスト**:
  - フロントエンド: Jest、React Testing Library
  - バックエンド: xUnit、Moq、FluentAssertions
- **API開発**: Swagger / OpenAPI（API仕様書の自動生成）

### 5.6 アーキテクチャ概要

```
┌─────────────────────────────────┐
│     ユーザー（ブラウザ）          │
└──────────────┬──────────────────┘
               │ HTTPS
               ▼
┌─────────────────────────────────┐
│      Google Cloud Run           │
│  ┌───────────────────────────┐  │
│  │  フロントエンドサービス     │  │
│  │  (Next.js/React)          │  │
│  └───────────┬───────────────┘  │
│              │ API呼び出し       │
│              ▼                   │
│  ┌───────────────────────────┐  │
│  │  バックエンドサービス       │  │
│  │  (.NET API)              │  │
│  └───────────┬───────────────┘  │
└──────────────┼──────────────────┘
               │
               ├───► CockroachDB (データベース)
               │
               ├───► Cloud Storage (静的アセット)
               │
               ├───► Secret Manager (機密情報)
               │
               └───► Cloud Logging (ログ)
```

**アーキテクチャの特徴**:
- **フロントエンド**: Next.jsをCloud Run上でコンテナとして実行（SSR/SSG対応）
- **バックエンド**: Cloud Run上で.NET APIをコンテナとして実行
- **データベース**: CockroachDB Cloud（マネージドサービス）を利用
- **スケーリング**: フロントエンドとバックエンドを独立してスケール可能
- **デプロイ**: フロントエンドとバックエンドを別々のCloud Runサービスとして管理
- **セキュリティ**: 各レイヤーでの適切なセキュリティ対策

### 5.7 技術スタック選択理由

#### 5.7.1 .NET（ASP.NET Core）
- **パフォーマンス**: 高いスループットと低レイテンシを実現
- **セキュリティ**: エンタープライズレベルのセキュリティ機能が標準装備
- **エコシステム**: 豊富なNuGetパッケージとコミュニティサポート
- **保守性**: 強力な型システムとツールサポートによる保守性の向上
- **Cloud Run対応**: コンテナ化が容易で、Cloud Runとの親和性が高い

#### 5.7.2 CockroachDB
- **スケーラビリティ**: 自動スケーリングにより、ユーザー数の増加に対応可能
- **高可用性**: マルチリージョン対応により、99.99%の可用性を実現
- **PostgreSQL互換**: 既存のPostgreSQLツールや知識を活用可能
- **分散トランザクション**: グローバルなACIDトランザクションをサポート
- **運用の簡素化**: 自動バックアップ、自動アップグレードなどの運用負荷軽減

#### 5.7.3 Google Cloud Run
- **統一されたデプロイ環境**: フロントエンドとバックエンドを同じプラットフォームで管理
- **コスト効率**: リクエスト数に応じた従量課金で、初期コストを抑えられる
- **自動スケーリング**: トラフィックの変動に自動対応（0スケールも可能）
- **独立スケーリング**: フロントエンドとバックエンドを別々にスケール可能
- **デプロイの簡素化**: Dockerコンテナをそのままデプロイ可能
- **セキュリティ**: Googleのセキュリティインフラを活用
- **統合性**: Cloud Run、CockroachDB、その他GCPサービスとの統合が容易
- **運用の統一**: ログ、監視、デプロイプロセスを一元管理

## 6. 制約事項

### 6.1 法的・倫理的制約
- **重要**: 実際のハッキング攻撃を実行する機能は含めない
- すべてのハッキング演習は安全なサンドボックス環境内で実行
- 教育目的のみに使用されることを明確に表示
- 悪用を防ぐための利用規約の明示

### 6.2 技術的制約
- ブラウザベースの実装（ネイティブアプリではない）
- セキュリティ上の理由から、一部のシステムコールは制限

### 6.3 リソース制約
- 初期開発はMVP（Minimum Viable Product）として機能を限定
- 段階的な機能追加を計画

## 7. 成功基準

### 7.1 ユーザー指標
- ユーザー登録数: 初年度1000人以上
- アクティブユーザー率: 登録ユーザーの30%以上
- チャレンジ完了率: 開始したチャレンジの60%以上
- ストーリー完了率: 開始したストーリーの70%以上（ストーリーの面白さを示す指標）
- ストーリーリプレイ率: 完了したストーリーの30%以上が複数回プレイされる
- ユーザー満足度: 4.0/5.0以上
- ストーリー評価: ストーリーに関する評価が4.2/5.0以上

### 7.2 技術指標
- ページ読み込み速度: Lighthouseスコア90以上
- バグ発生率: 重大なバグ0件、軽微なバグは月5件以下
- テストカバレッジ: 80%以上

### 7.3 ビジネス指標
- ユーザーエンゲージメント: 平均セッション時間15分以上
- ストーリーエンゲージメント: ストーリーモードでの平均滞在時間20分以上
- リテンション率: 1週間後のリテンション率40%以上
- ストーリー継続率: チャプター1を開始したユーザーの80%以上がチャプター2に進む
- 口コミ・シェア率: ユーザーの15%以上がストーリーをSNS等でシェア

## 8. リリース計画

### 8.1 Phase 1: MVP（最小機能版）
- **ストーリー**:
  - 基本的なストーリーモード（5チャプター）
  - 魅力的なプロットとキャラクター設定
  - 選択肢による分岐ストーリー（最低2つのエンディング）
  - ストーリーの面白さを重視したコンテンツ制作
- **技術機能**:
  - シンプルなハッキングチャレンジ（5-10個）
  - ユーザー認証・進捗管理
- **目標リリース**: 開発開始から3ヶ月

### 8.2 Phase 2: 機能拡張
- **ストーリー**:
  - 新ストーリーラインの追加（別テーマの5チャプターストーリー）
  - より複雑な分岐と複数のエンディング
  - ビジュアル表現の強化（キャラクターイラスト、背景）
  - BGM・効果音の追加
  - ストーリー専用バッジ・アチーブメント
- **技術機能**:
  - より高度なハッキングチャレンジ
  - バッジ・アチーブメントシステム
- **目標リリース**: Phase 1から2ヶ月後

### 8.3 Phase 3: コミュニティ機能
- **ストーリー**:
  - 新ストーリーラインの追加（複数のストーリーシリーズ）
  - ユーザー生成コンテンツ（UGC）のサポート（将来拡張）
  - ストーリー評価・レビュー機能
- **技術機能**:
  - ランキング機能
  - チャレンジ共有機能
  - ディスカッション機能
- **目標リリース**: Phase 2から3ヶ月後

## 9. リスク管理

### 9.1 技術的リスク
- **リスク**: セキュリティ脆弱性の発生
- **対策**: 定期的なセキュリティ監査、ペネトレーションテストの実施

### 9.2 法的リスク
- **リスク**: 悪用される可能性
- **対策**: 明確な利用規約、監視機能の実装、報告機能の提供

### 9.3 ビジネスリスク
- **リスク**: ユーザー獲得の困難
- **対策**: マーケティング戦略の策定、SNSでのプロモーション

## 10. 用語定義

- **ハッキング**: 本プロジェクトでは、セキュリティの脆弱性を発見・理解するための教育目的の技術を指す
- **チャレンジ**: ユーザーが実際にハッキング技術を試すことができる演習問題
- **チャプター**: ストーリーの1つの区切りで、特定のテーマに焦点を当てた学習セクション

## 11. 承認・承認者

| 項目 | 承認者 | 承認日 |
|------|--------|--------|
| ビジネス要件定義 | | |
| 技術要件定義 | | |
| 最終承認 | | |

---

**文書バージョン**: 1.0  
**作成日**: 2024年  
**最終更新日**: 2024年

